<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1                                        <el-statistic title="Agents" :value="scanResult.scan_summary && scanResult.scan_summar                                            :value="pathsResult.analysis_summary && pathsResult.analysis_summary.total_paths || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic 
                                            title="Critical Paths" 
                                            :value="pathsResult.analysis_summary && pathsResult.analysis_summary.critical_paths || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic 
                                            title="Average Length" 
                                            :value="pathsResult.analysis_summary && pathsResult.analysis_summary.average_length || 0" nts || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic title="Tools" :value="scanResult.scan_summary && scanResult.scan_summary.total_tools || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic title="Files" :value="scanResult.scan_summary && scanResult.scan_summary.total_files || 0" />  <title>SentinelAgent - AI Agent System Analysis & Monitoring Platform</title>
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Element Plus -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    
    <!-- D3.js for visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <div id="app">
        <el-container class="main-container">
            <!-- Â§¥ÈÉ® -->
            <el-header class="header">
                <div class="header-content">
                    <h1 class="title">
                        ü§ñ SentinelAgent
                        <span class="subtitle">AI Agent System Analysis & Monitoring Platform</span>
                    </h1>
                    <div class="header-actions">
                        <el-button type="primary" @click="showAbout = true">
                            About
                        </el-button>
                    </div>
                </div>
            </el-header>

            <el-container>
                <!-- ‰æßËæπÊ†è -->
                <el-aside width="300px" class="sidebar">
                    <el-menu 
                        :default-active="activeTab" 
                        @select="handleMenuSelect"
                        class="sidebar-menu">
                        
                        <el-menu-item index="scanner">
                            <el-icon><Search /></el-icon>
                            <span>System Scan</span>
                        </el-menu-item>
                        
                        <el-menu-item index="graph">
                            <el-icon><Connection /></el-icon>
                            <span>Relationship Graph</span>
                        </el-menu-item>
                        
                        <el-menu-item index="paths">
                            <el-icon><Guide /></el-icon>
                            <span>Path Analysis</span>
                        </el-menu-item>
                        
                        <el-menu-item index="logs">
                            <el-icon><Document /></el-icon>
                            <span>Log Analysis</span>
                        </el-menu-item>
                        
                        <el-menu-item index="results">
                            <el-icon><Folder /></el-icon>
                            <span>Analysis Results</span>
                        </el-menu-item>
                    </el-menu>

                    <!-- Á§∫‰æãÈ°πÁõÆ -->
                    <div class="examples-section">
                        <h3>Example Projects</h3>
                        <el-card 
                            v-for="example in examples" 
                            :key="example.name"
                            class="example-card"
                            @click="loadExample(example)">
                            <div class="example-info">
                                <h4 v-text="example.name"></h4>
                                <p v-text="example.description"></p>
                                <el-tag :type="example.type === 'crewai' ? 'success' : 'warning'"
                                        v-text="example.type">
                                </el-tag>
                            </div>
                        </el-card>
                    </div>
                </el-aside>

                <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
                <el-main class="main-content">
                    <!-- Á≥ªÁªüÊâ´Êèè -->
                    <div v-show="activeTab === 'scanner'" class="tab-content">
                        <el-card class="content-card">
                            <template #header>
                                <h2>üîç System Scan</h2>
                            </template>
                            
                            <el-form :model="scanForm" label-width="120px">
                                <el-form-item label="Scan Path">
                                    <el-input 
                                        v-model="scanForm.path" 
                                        placeholder="Enter directory or file path to scan"
                                        class="path-input">
                                        <template #append>
                                            <el-button @click="browseForScanPath" icon="Folder">Browse</el-button>
                                        </template>
                                    </el-input>
                                </el-form-item>
                                
                                <el-form-item label="Scan Type">
                                    <el-radio-group v-model="scanForm.type">
                                        <el-radio label="directory">Directory</el-radio>
                                        <el-radio label="file">Single File</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                
                                <el-form-item>
                                    <el-button 
                                        type="primary" 
                                        @click="executeScan"
                                        :loading="scanLoading">
                                        Start Scan
                                    </el-button>
                                    <el-button @click="clearScanResult">Clear Results</el-button>
                                    <el-button type="info" @click="loadDemoData">Load Demo Data</el-button>
                                </el-form-item>
                            </el-form>

                            <!-- Êâ´ÊèèÁªìÊûú -->
                            <div v-if="scanResult" class="result-section">
                                <h3>Scan Results</h3>
                                
                                <!-- Âü∫Êú¨ÁªüËÆ°‰ø°ÊÅØ -->
                                <el-row :gutter="20">
                                    <el-col :span="4">
                                        <el-statistic title="Agents" :value="{% raw %}(scanResult.scan_summary && scanResult.scan_summary.total_agents) || 0{% endraw %}" />
                                    </el-col>
                                    <el-col :span="4">
                                        <el-statistic title="Tools" :value="{% raw %}(scanResult.scan_summary && scanResult.scan_summary.total_tools) || 0{% endraw %}" />
                                    </el-col>
                                    <el-col :span="4">
                                        <el-statistic title="Crews" :value="{% raw %}(scanResult.scan_summary && scanResult.scan_summary.total_crews) || 0{% endraw %}" />
                                    </el-col>
                                    <el-col :span="4">
                                        <el-statistic title="Tasks" :value="{% raw %}(scanResult.scan_summary && scanResult.scan_summary.total_tasks) || 0{% endraw %}" />
                                    </el-col>
                                    <el-col :span="4">
                                        <el-statistic title="Files" :value="{% raw %}(scanResult.scan_summary && scanResult.scan_summary.total_files) || 0{% endraw %}" />
                                    </el-col>
                                    <el-col :span="4">
                                        <el-statistic title="Python Files" :value="{% raw %}(scanResult.scan_summary && scanResult.scan_summary.python_files) || 0{% endraw %}" />
                                    </el-col>
                                </el-row>

                                <!-- ËØ¶ÁªÜ‰ø°ÊÅØÈÄâÈ°πÂç° -->
                                <el-tabs v-model="activeResultTab" style="margin-top: 20px;">
                                    <!-- AgentsÂàóË°® -->
                                    <el-tab-pane label="Agents" name="agents" v-if="scanResult.agents && scanResult.agents.length > 0">
                                        <el-table :data="scanResult.agents" style="width: 100%" max-height="400">
                                            <el-table-column prop="name" label="Name" width="150" />
                                            <el-table-column label="Type" width="120">
                                                <template #default="scope">
                                                    <el-tag :type="getAgentTypeColor(scope.row)" size="small">
                                                        {% raw %}{{ scope.row.type }}{% endraw %}
                                                    </el-tag>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="arguments.role" label="Role" width="200" />
                                            <el-table-column prop="arguments.goal" label="Goal" show-overflow-tooltip />
                                            <el-table-column label="File" show-overflow-tooltip>
                                                <template #default="scope">
                                                    <el-tooltip :content="scope.row.file">
                                                        <span>{% raw %}{{ formatFilePath(scope.row.file) }}{% endraw %}</span>
                                                    </el-tooltip>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="line" label="Line" width="80" />
                                        </el-table>
                                    </el-tab-pane>
                                    
                                    <!-- ToolsÂàóË°® -->
                                    <el-tab-pane label="Tools" name="tools" v-if="scanResult.tools && scanResult.tools.length > 0">
                                        <el-table :data="scanResult.tools" style="width: 100%" max-height="400">
                                            <el-table-column prop="name" label="Name" width="200" />
                                            <el-table-column label="Type" width="150">
                                                <template #default="scope">
                                                    <el-tag :type="getToolTypeColor(scope.row)" size="small">
                                                        {% raw %}{{ scope.row.type }}{% endraw %}
                                                    </el-tag>
                                                </template>
                                            </el-table-column>
                                            <el-table-column label="File" show-overflow-tooltip>
                                                <template #default="scope">
                                                    <el-tooltip :content="scope.row.file">
                                                        <span>{% raw %}{{ formatFilePath(scope.row.file) }}{% endraw %}</span>
                                                    </el-tooltip>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="line" label="Line" width="80" />
                                        </el-table>
                                    </el-tab-pane>
                                    
                                    <!-- CrewsÂàóË°® -->
                                    <el-tab-pane label="Crews" name="crews" v-if="scanResult.crews && scanResult.crews.length > 0">
                                        <el-table :data="scanResult.crews" style="width: 100%" max-height="400">
                                            <el-table-column prop="name" label="Name" width="150" />
                                            <el-table-column label="Type" width="120">
                                                <template #default="scope">
                                                    <el-tag type="primary" size="small">
                                                        {% raw %}{{ scope.row.type }}{% endraw %}
                                                    </el-tag>
                                                </template>
                                            </el-table-column>
                                            <el-table-column label="File" show-overflow-tooltip>
                                                <template #default="scope">
                                                    <el-tooltip :content="scope.row.file">
                                                        <span>{% raw %}{{ formatFilePath(scope.row.file) }}{% endraw %}</span>
                                                    </el-tooltip>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="line" label="Line" width="80" />
                                        </el-table>
                                    </el-tab-pane>
                                    
                                    <!-- TasksÂàóË°® -->
                                    <el-tab-pane label="Tasks" name="tasks" v-if="scanResult.tasks && scanResult.tasks.length > 0">
                                        <el-table :data="scanResult.tasks" style="width: 100%" max-height="400">
                                            <el-table-column prop="name" label="Name" width="150" />
                                            <el-table-column label="Type" width="120">
                                                <template #default="scope">
                                                    <el-tag :type="getTaskTypeColor(scope.row)" size="small">
                                                        {% raw %}{{ scope.row.type }}{% endraw %}
                                                    </el-tag>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="assigned_agent" label="Assigned Agent" width="150" />
                                            <el-table-column label="Dependencies" width="200">
                                                <template #default="scope">
                                                    <el-tag v-for="dep in scope.row.dependencies" :key="dep" size="small" style="margin-right: 4px;">
                                                        {% raw %}{{ dep }}{% endraw %}
                                                    </el-tag>
                                                </template>
                                            </el-table-column>
                                            <el-table-column label="File" show-overflow-tooltip>
                                                <template #default="scope">
                                                    <el-tooltip :content="scope.row.file">
                                                        <span>{% raw %}{{ formatFilePath(scope.row.file) }}{% endraw %}</span>
                                                    </el-tooltip>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="line" label="Line" width="80" />
                                        </el-table>
                                    </el-tab-pane>
                                    
                                    <!-- Êñá‰ª∂ÁªìÊûÑ -->
                                    <el-tab-pane label="File Structure" name="fileStructure">
                                        <el-row :gutter="20">
                                            <el-col :span="12">
                                                <el-card>
                                                    <template #header>
                                                        <span>File Statistics</span>
                                                    </template>
                                                    <el-descriptions :column="1" size="small">
                                                        <el-descriptions-item label="Total Files">
                                                            {% raw %}{{ scanResult.file_structure && scanResult.file_structure.total_files || 0 }}{% endraw %}
                                                        </el-descriptions-item>
                                                        <el-descriptions-item label="Python Files">
                                                            {% raw %}{{ scanResult.file_structure && scanResult.file_structure.python_files || 0 }}{% endraw %}
                                                        </el-descriptions-item>
                                                        <el-descriptions-item label="Directories">
                                                            {% raw %}{{ scanResult.file_structure && scanResult.file_structure.directories || 0 }}{% endraw %}
                                                        </el-descriptions-item>
                                                    </el-descriptions>
                                                </el-card>
                                            </el-col>
                                            <el-col :span="12">
                                                <el-card>
                                                    <template #header>
                                                        <span>File Types</span>
                                                    </template>
                                                    <div style="max-height: 300px; overflow-y: auto;">
                                                        <el-tag 
                                                            v-for="(count, type) in scanResult.file_structure && scanResult.file_structure.file_types" 
                                                            :key="type" 
                                                            size="small" 
                                                            style="margin: 2px;"
                                                        >
                                                            {% raw %}{{ type || 'no-ext' }}: {{ count }}{% endraw %}
                                                        </el-tag>
                                                    </div>
                                                </el-card>
                                            </el-col>
                                        </el-row>
                                    </el-tab-pane>
                                </el-tabs>
                            </div>
                        </el-card>
                    </div>

                    <!-- ÂÖ≥Á≥ªÂõæÊûÑÂª∫ -->
                    <div v-show="activeTab === 'graph'" class="tab-content">
                        <el-card class="content-card">
                            <template #header>
                                <h2>üîó Relationship Graph</h2>
                            </template>
                            
                            <el-form :model="graphForm" label-width="120px">
                                <el-form-item label="Data Source">
                                    <el-radio-group v-model="graphForm.dataSource">
                                        <el-radio label="scan">Use Scan Results</el-radio>
                                        <el-radio label="path">Direct Path Scan</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                
                                <el-form-item v-if="graphForm.dataSource === 'path'" label="Scan Path">
                                    <el-input v-model="graphForm.path" placeholder="Enter path" />
                                </el-form-item>
                                
                                <el-form-item>
                                    <el-button 
                                        type="primary" 
                                        @click="buildGraph"
                                        :loading="graphLoading"
                                        :disabled="graphForm.dataSource === 'scan' && !scanResult">
                                        Build Graph
                                    </el-button>
                                    <el-button type="info" @click="loadDemoGraph">Load Demo Graph</el-button>
                                </el-form-item>
                            </el-form>

                            <!-- ÂõæÂèØËßÜÂåñ -->
                            <div v-if="graphResult" class="graph-visualization">
                                <h3>Relationship Graph</h3>
                                <div id="graph-container" class="graph-container"></div>
                                
                                <!-- ÂõæÁªüËÆ°‰ø°ÊÅØ -->
                                <el-row :gutter="20" class="graph-stats">
                                    <el-col :span="6">
                                        <el-statistic title="Nodes" :value="graphResult.metadata && graphResult.metadata.total_nodes || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic title="Edges" :value="graphResult.metadata && graphResult.metadata.total_edges || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic title="Components" :value="graphResult.metadata && graphResult.metadata.components || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic title="Density" :value="graphResult.metadata && graphResult.metadata.density || 0" :precision="3" />
                                    </el-col>
                                </el-row>
                            </div>
                        </el-card>
                    </div>

                    <!-- Ë∑ØÂæÑÂàÜÊûê -->
                    <div v-show="activeTab === 'paths'" class="tab-content">
                        <el-card class="content-card">
                            <template #header>
                                <h2>üõ£Ô∏è Path Analysis</h2>
                            </template>
                            
                            <el-form :model="pathsForm" label-width="120px">
                                <el-form-item label="Data Source">
                                    <el-radio-group v-model="pathsForm.dataSource">
                                        <el-radio label="graph">Use Graph Data</el-radio>
                                        <el-radio label="file">Graph File</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                
                                <el-form-item v-if="pathsForm.dataSource === 'file'" label="Graph File">
                                    <el-input v-model="pathsForm.graphFile" placeholder="Enter graph file path">
                                        <template #append>
                                            <el-button @click="browseForGraphFile" icon="Folder">Browse</el-button>
                                        </template>
                                    </el-input>
                                </el-form-item>
                                
                                <el-form-item>
                                    <el-button 
                                        type="primary" 
                                        @click="analyzePaths"
                                        :loading="pathsLoading"
                                        :disabled="pathsForm.dataSource === 'graph' && !graphResult">
                                        Analyze Paths
                                    </el-button>
                                    <el-button type="info" @click="loadDemoPaths">Load Demo Paths</el-button>
                                </el-form-item>
                            </el-form>

                            <!-- Ë∑ØÂæÑÂàÜÊûêÁªìÊûú -->
                            <div v-if="pathsResult" class="paths-result">
                                <h3>Path Analysis Results</h3>
                                
                                <!-- Ë∑ØÂæÑÁªüËÆ° -->
                                <el-row :gutter="20">
                                    <el-col :span="6">
                                        <el-statistic 
                                            title="Total Paths" 
                                            :value="{% raw %}(pathsResult.overall_assessment && pathsResult.overall_assessment.total_paths_analyzed) || 0{% endraw %}" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic 
                                            title="Risk Level" 
                                            :value="{% raw %}(pathsResult.overall_assessment && pathsResult.overall_assessment.risk_level) || 'unknown'{% endraw %}" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic 
                                            title="Risk Score" 
                                            :value="{% raw %}(pathsResult.overall_assessment && pathsResult.overall_assessment.total_risk_score) || 0{% endraw %}" 
                                            :precision="3" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic 
                                            title="Suspicious Patterns" 
                                            :value="{% raw %}(pathsResult.overall_assessment && pathsResult.overall_assessment.suspicious_patterns_found) || 0{% endraw %}" />
                                    </el-col>
                                </el-row>

                                <!-- ÊâßË°åË∑ØÂæÑÂàóË°® -->
                                <div v-if="pathsResult.execution_paths && pathsResult.execution_paths.length > 0">
                                    <h4>Execution Paths</h4>
                                    <el-collapse>
                                        <el-collapse-item 
                                            v-for="(path, index) in pathsResult.execution_paths.slice(0, 15)" 
                                            :key="index"
                                            title="Path Details">
                                            <div class="path-details">
                                                <p><strong>Type:</strong> <span v-text="path.path_type"></span></p>
                                                <p v-if="path.is_temporal"><strong>Temporal Execution Order:</strong> <span v-text="getTemporalOrder(path)"></span></p>
                                                <p v-else><strong>Path:</strong> <span v-text="getPathString(path)"></span></p>
                                                <p><strong>Risk Score:</strong> <span v-text="getRiskScore(path)"></span></p>
                                                <div class="path-nodes">
                                                    <el-tag 
                                                        v-for="(node, nodeIndex) in path.path" 
                                                        :key="nodeIndex"
                                                        class="path-node"
                                                        :type="path.is_temporal ? 'success' : 'info'"
                                                        v-text="node">
                                                    </el-tag>
                                                </div>
                                            </div>
                                        </el-collapse-item>
                                    </el-collapse>
                                </div>

                                <!-- Ë∑ØÂæÑÁ±ªÂûãÂàÜÂ∏É -->
                                <div v-if="pathsResult.path_analysis && pathsResult.path_analysis.path_type_distribution">
                                    <h4>Path Type Distribution</h4>
                                    <el-row :gutter="10">
                                        <el-col :span="6" v-for="(count, type) in pathsResult.path_analysis.path_type_distribution" :key="type">
                                            <el-statistic 
                                                :title="type.replace('_', ' ').toUpperCase()" 
                                                :value="count" />
                                        </el-col>
                                    </el-row>
                                </div>

                                <!-- Êé®ËçêÂª∫ËÆÆ -->
                                <div v-if="pathsResult.recommendations && pathsResult.recommendations.length > 0">
                                    <h4>Recommendations</h4>
                                    <ul class="recommendations-list">
                                        <li v-for="(rec, index) in pathsResult.recommendations" :key="index"
                                            v-text="rec">
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </el-card>
                    </div>

                    <!-- Êó•ÂøóÂàÜÊûê -->
                    <div v-show="activeTab === 'logs'" class="tab-content">
                        <el-card class="content-card">
                            <template #header>
                                <h2>üìä Log Analysis</h2>
                            </template>
                            
                            <el-form :model="logsForm" label-width="120px">
                                <el-form-item label="Log File">
                                    <el-input v-model="logsForm.logFile" placeholder="Enter log file path">
                                        <template #append>
                                            <el-button @click="browseForLogFile" icon="Folder">Browse</el-button>
                                        </template>
                                    </el-input>
                                </el-form-item>
                                
                                <el-form-item label="Log Format">
                                    <el-select v-model="logsForm.format">
                                        <el-option label="Auto Detect" value="auto" />
                                        <el-option label="CSV Format" value="csv" />
                                        <el-option label="Text Format" value="txt" />
                                        <el-option label="JSON Format (CrewAI)" value="json" />
                                    </el-select>
                                </el-form-item>
                                
                                <el-form-item label="Graph File">
                                    <el-input v-model="logsForm.graphFile" placeholder="Optional: Graph file for path validation" />
                                </el-form-item>
                                
                                <el-form-item>
                                    <el-button 
                                        type="primary" 
                                        @click="analyzeLogs"
                                        :loading="logsLoading">
                                        Analyze Logs
                                    </el-button>
                                    <el-button type="info" @click="loadDemoLogs">Load Demo Logs</el-button>
                                    <el-button type="success" @click="loadJsonLogs">Load JSON Logs</el-button>
                                </el-form-item>
                            </el-form>

                            <!-- Êó•ÂøóÂàÜÊûêÁªìÊûú -->
                            <div v-if="logsResult" class="logs-result">
                                <h3>Log Analysis Results</h3>
                                
                                <!-- JSONÊ†ºÂºèÊó•ÂøóÁöÑÁâπÊÆäÊòæÁ§∫ -->
                                <div v-if="isJsonLogResult(logsResult)" class="json-log-visualization">
                                    <el-tabs v-model="logViewMode" type="border-card">
                                        <el-tab-pane label="Overview" name="overview">
                                            <!-- ÊâßË°åÁªüËÆ° -->
                                            <el-row :gutter="20" class="stats-row">
                                                <el-col :span="6">
                                                    <el-statistic 
                                                        title="Total Entries" 
                                                        :value="{% raw %}(logsResult.metadata && logsResult.metadata.total_entries) || 0{% endraw %}" />
                                                </el-col>
                                                <el-col :span="6">
                                                    <el-statistic 
                                                        title="Agent Executions" 
                                                        :value="{% raw %}getAgentExecutions(logsResult).length{% endraw %}" />
                                                </el-col>
                                                <el-col :span="6">
                                                    <el-statistic 
                                                        title="Tool Calls" 
                                                        :value="getToolExecutions(logsResult).length" />
                                                </el-col>
                                                <el-col :span="6">
                                                    <el-statistic 
                                                        title="Unique Agents" 
                                                        :value="getUniqueAgents(logsResult).length" />
                                                </el-col>
                                            </el-row>
                                        </el-tab-pane>
                                        
                                        <el-tab-pane label="Execution Flow" name="flow">
                                            <div class="execution-flow">
                                                <div v-for="(entry, index) in logsResult.execution_log" :key="index" 
                                                     class="execution-entry" :class="entry.entry_type">
                                                    <div class="entry-header">
                                                        <el-tag :type="{% raw %}getEntryTagType(entry.entry_type){% endraw %}">
                                                            {% raw %}{{ entry.entry_type.replace('_', ' ').toUpperCase() }}{% endraw %}
                                                        </el-tag>
                                                        <span class="entry-id">{% raw %}{{ entry.example_id }}{% endraw %}</span>
                                                        <span class="entry-time">{% raw %}{{ formatTime(entry.timestamp) }}{% endraw %}</span>
                                                    </div>
                                                    
                                                    <div v-if="entry.agent && entry.agent.role" class="agent-info">
                                                        <h4>ü§ñ {% raw %}{{ entry.agent.role }}{% endraw %}</h4>
                                                        <p><strong>Goal:</strong> {% raw %}{{ entry.agent.goal }}{% endraw %}</p>
                                                        <p><strong>Backstory:</strong> {% raw %}{{ entry.agent.backstory }}{% endraw %}</p>
                                                    </div>
                                                    
                                                    <div v-if="entry.task && entry.task.from" class="email-info">
                                                        <h4>üìß Email Task</h4>
                                                        <p><strong>From:</strong> {% raw %}{{ entry.task.from }}{% endraw %}</p>
                                                        <p><strong>Subject:</strong> {% raw %}{{ entry.task.subject }}{% endraw %}</p>
                                                        <div v-if="entry.task.body" class="email-body">
                                                            <strong>Content:</strong>
                                                            <p>{% raw %}{{ entry.task.body }}{% endraw %}</p>
                                                        </div>
                                                        <div v-if="entry.task.classification_rules && entry.task.classification_rules.length" class="classification-rules">
                                                            <strong>Classification Rules:</strong>
                                                            <ul>
                                                                <li v-for="rule in entry.task.classification_rules" :key="rule.category">
                                                                    <strong>{% raw %}{{ rule.category }}{% endraw %}:</strong> {% raw %}{{ rule.description }}{% endraw %}
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    
                                                    <div v-if="entry.output && entry.output.raw" class="output-info">
                                                        <h4>üì§ Output</h4>
                                                        <pre class="output-content">{% raw %}{{ entry.output.raw }}{% endraw %}</pre>
                                                    </div>
                                                    
                                                    <div v-if="entry.tools && entry.tools.length" class="tools-info">
                                                        <h4>üîß Tools Used</h4>
                                                        <el-tag v-for="tool in entry.tools" :key="tool.name" class="tool-tag">
                                                            {% raw %}{{ tool.name }}{% endraw %}
                                                        </el-tag>
                                                    </div>
                                                </div>
                                            </div>
                                        </el-tab-pane>
                                        
                                        <el-tab-pane label="Agent Timeline" name="timeline">
                                            <div class="agent-timeline">
                                                <el-timeline>
                                                    <el-timeline-item 
                                                        v-for="(entry, index) in logsResult.execution_log" 
                                                        :key="index"
                                                        :timestamp="{% raw %}formatTime(entry.timestamp){% endraw %}"
                                                        :type="{% raw %}getTimelineType(entry.entry_type){% endraw %}">
                                                        <div class="timeline-content">
                                                            <h4>{% raw %}{{ (entry.agent && entry.agent.role) || 'System' }}{% endraw %}</h4>
                                                            <p v-if="{% raw %}entry.task && entry.task.subject{% endraw %}">üìß {% raw %}{{ entry.task.subject }}{% endraw %}</p>
                                                            <p v-if="{% raw %}entry.output && entry.output.raw{% endraw %}" class="output-preview">
                                                                {% raw %}{{ truncateText(entry.output.raw, 100) }}{% endraw %}
                                                            </p>
                                                        </div>
                                                    </el-timeline-item>
                                                </el-timeline>
                                            </div>
                                        </el-tab-pane>
                                        
                                        <el-tab-pane label="Raw Data" name="raw">
                                            <div class="raw-data">
                                                <pre class="json-display">{% raw %}{{ JSON.stringify(logsResult, null, 2) }}{% endraw %}</pre>
                                            </div>
                                        </el-tab-pane>
                                    </el-tabs>
                                </div>
                                
                                <!-- ‰º†ÁªüÊ†ºÂºèÊó•ÂøóÁöÑÊòæÁ§∫ -->
                                <div v-else class="traditional-log-result">
                                    <!-- ÊâßË°åÁªüËÆ° -->
                                    <el-row :gutter="20">
                                        <el-col :span="6">
                                            <el-statistic 
                                                title="Total Entries" 
                                                :value="{% raw %}(logsResult.log_summary && logsResult.log_summary.total_entries) || 0{% endraw %}" />
                                        </el-col>
                                        <el-col :span="6">
                                            <el-statistic 
                                                title="Execution Paths" 
                                                :value="{% raw %}(logsResult.execution_paths && logsResult.execution_paths.length) || 0{% endraw %}" />
                                        </el-col>
                                        <el-col :span="6">
                                            <el-statistic 
                                                title="Anomalies" 
                                                :value="{% raw %}(logsResult.anomalies && logsResult.anomalies.length) || 0{% endraw %}" />
                                        </el-col>
                                        <el-col :span="6">
                                            <el-statistic 
                                                title="Success Rate" 
                                                :value="calculateSuccessRate(logsResult)" 
                                                suffix="%" />
                                        </el-col>
                                    </el-row>

                                    <!-- ÂºÇÂ∏∏ÂàóË°® -->
                                    <div v-if="logsResult.anomalies && logsResult.anomalies.length > 0">
                                        <h4>Detected Anomalies</h4>
                                        <el-alert 
                                            v-for="(anomaly, index) in logsResult.anomalies" 
                                            :key="index"
                                            :title="anomaly.type"
                                            :description="anomaly.description"
                                            type="warning"
                                            class="anomaly-alert" />
                                    </div>

                                    <!-- Âª∫ËÆÆ -->
                                    <div v-if="logsResult.recommendations && logsResult.recommendations.length > 0">
                                        <h4>Optimization Recommendations</h4>
                                        <ul class="recommendations-list">
                                            <li v-for="(rec, index) in logsResult.recommendations" :key="index"
                                                v-text="rec">
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </el-card>
                    </div>

                    <!-- ÂàÜÊûêÁªìÊûú -->
                    <div v-show="activeTab === 'results'" class="tab-content">
                        <el-card class="content-card">
                            <template #header>
                                <h2>üìÅ Analysis Results</h2>
                            </template>
                            
                            <el-button @click="loadResults" type="primary" class="refresh-btn">
                                Refresh List
                            </el-button>
                            <el-button @click="loadDemoResults" type="info" class="demo-btn">
                                Load Demo Results
                            </el-button>

                            <el-table :data="resultFiles" style="width: 100%">
                                <el-table-column prop="filename" label="File Name" show-overflow-tooltip />
                                <el-table-column prop="type" label="Type" width="100">
                                    <template #default="scope">
                                        <el-tag :type="getResultTypeColor(scope.row.type)"
                                                v-text="scope.row.type">
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="size" label="Size" width="100">
                                    <template #default="scope">
                                        <span v-text="formatFileSize(scope.row.size)"></span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="modified" label="Modified Time" width="200">
                                    <template #default="scope">
                                        <span v-text="formatDate(scope.row.modified)"></span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Actions" width="150">
                                    <template #default="scope">
                                        <el-button 
                                            size="small" 
                                            @click="viewResult(scope.row)">
                                            View
                                        </el-button>
                                        <el-button 
                                            size="small" 
                                            type="danger" 
                                            @click="deleteResult(scope.row)">
                                            Delete
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-card>
                    </div>
                </el-main>
            </el-container>
        </el-container>

        <!-- ÂÖ≥‰∫éÂØπËØùÊ°Ü -->
        <el-dialog v-model="showAbout" title="About SentinelAgent" width="50%">
            <div class="about-content">
                <h3>üîç SentinelAgent - AI Agent System Analysis & Monitoring Tool</h3>
                <p>SentinelAgent is a comprehensive tool designed for analyzing and detecting AI Agent systems, providing the following features:</p>
                <ul>
                    <li>üîç <strong>System Scanning</strong>: Automatically identify Agents, Tools, Crews and other components</li>
                    <li>üîó <strong>Relationship Graph</strong>: Build relationship graphs between system components</li>
                    <li>üõ£Ô∏è <strong>Path Analysis</strong>: Analyze execution paths and critical paths</li>
                    <li>üìä <strong>Log Analysis</strong>: Deep analysis of execution logs and anomaly detection</li>
                </ul>
                <p>Supported frameworks: CrewAI, AutoGen, LangChain and other mainstream Agent frameworks</p>
            </div>
        </el-dialog>

        <!-- ÁªìÊûúÊü•ÁúãÂØπËØùÊ°Ü -->
        <el-dialog v-model="showResultDialog" :title="{% raw %}(currentResult && currentResult.filename) || 'Result'{% endraw %}" width="80%">
            <pre class="result-content" v-text="JSON.stringify(currentResultData, null, 2)"></pre>
        </el-dialog>

        <!-- Êñá‰ª∂ÊµèËßàÂô®ÂØπËØùÊ°Ü -->
        <el-dialog 
            v-model="showFileBrowser" 
            :title="fileBrowserTitle" 
            width="70%"
            @close="closeBrowser">
            <div class="file-browser">
                <div class="browser-header">
                    <el-breadcrumb separator="/">
                        <el-breadcrumb-item v-text="currentBrowserPath"></el-breadcrumb-item>
                    </el-breadcrumb>
                    <div v-if="fileBrowserMode === 'directory'" style="margin-top: 10px;">
                        <el-button type="primary" @click="selectCurrentDirectory">Select This Directory</el-button>
                    </div>
                </div>
                
                <el-table 
                    :data="browserItems" 
                    v-loading="browserLoading"
                    @row-click="onBrowserItemClick"
                    style="width: 100%; margin-top: 15px; cursor: pointer;">
                    <el-table-column prop="name" label="Name" min-width="200">
                        <template #default="scope">
                            <div style="display: flex; align-items: center;">
                                <el-icon v-if="scope.row.type === 'directory'" style="margin-right: 8px; color: #409EFF;">
                                    <Folder />
                                </el-icon>
                                <el-icon v-else style="margin-right: 8px; color: #67C23A;">
                                    <Document />
                                </el-icon>
                                <span v-text="scope.row.name"></span>
                            </div>
                        </template>
                    </el-table-column>
                    <el-table-column prop="type" label="Type" width="100">
                        <template #default="scope">
                            <el-tag :type="scope.row.type === 'directory' ? 'primary' : 'success'" size="small">
                                <span v-text="scope.row.type"></span>
                            </el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column prop="size" label="Size" width="100">
                        <template #default="scope">
                            <span v-if="scope.row.type === 'file'" v-text="formatFileSize(scope.row.size)"></span>
                            <span v-else>-</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="modified" label="Modified" width="180">
                        <template #default="scope">
                            <span v-if="scope.row.type === 'file'" v-text="formatDate(scope.row.modified)"></span>
                            <span v-else>-</span>
                        </template>
                    </el-table-column>
                </el-table>
            </div>
            
            <template #footer>
                <div class="dialog-footer">
                    <el-button @click="closeBrowser">Cancel</el-button>
                    <el-button v-if="fileBrowserMode === 'directory'" type="primary" @click="selectCurrentDirectory">
                        Select Directory
                    </el-button>
                </div>
            </template>
        </el-dialog>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
