<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SentinelAgent - AI AgentÁ≥ªÁªüÂàÜÊûê‰∏éÁõëÊéßÂπ≥Âè∞</title>
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Element Plus -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    
    <!-- D3.js for visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Ëá™ÂÆö‰πâÊ†∑Âºè -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <div id="app">
        <el-container class="main-container">
            <!-- Â§¥ÈÉ® -->
            <el-header class="header">
                <div class="header-content">
                    <h1 class="title">
                        ü§ñ SentinelAgent
                        <span class="subtitle">AI AgentÁ≥ªÁªüÂàÜÊûê‰∏éÁõëÊéßÂπ≥Âè∞</span>
                    </h1>
                    <div class="header-actions">
                        <el-button type="primary" @click="showAbout = true">
                            ÂÖ≥‰∫é
                        </el-button>
                    </div>
                </div>
            </el-header>

            <el-container>
                <!-- ‰æßËæπÊ†è -->
                <el-aside width="300px" class="sidebar">
                    <el-menu 
                        :default-active="activeTab" 
                        @select="handleMenuSelect"
                        class="sidebar-menu">
                        
                        <el-menu-item index="scanner">
                            <el-icon><Search /></el-icon>
                            <span>Á≥ªÁªüÊâ´Êèè</span>
                        </el-menu-item>
                        
                        <el-menu-item index="graph">
                            <el-icon><Connection /></el-icon>
                            <span>ÂÖ≥Á≥ªÂõæÊûÑÂª∫</span>
                        </el-menu-item>
                        
                        <el-menu-item index="paths">
                            <el-icon><Guide /></el-icon>
                            <span>Ë∑ØÂæÑÂàÜÊûê</span>
                        </el-menu-item>
                        
                        <el-menu-item index="logs">
                            <el-icon><Document /></el-icon>
                            <span>Êó•ÂøóÂàÜÊûê</span>
                        </el-menu-item>
                        
                        <el-menu-item index="results">
                            <el-icon><Folder /></el-icon>
                            <span>ÂàÜÊûêÁªìÊûú</span>
                        </el-menu-item>
                    </el-menu>

                    <!-- Á§∫‰æãÈ°πÁõÆ -->
                    <div class="examples-section">
                        <h3>Á§∫‰æãÈ°πÁõÆ</h3>
                        <el-card 
                            v-for="example in examples" 
                            :key="example.name"
                            class="example-card"
                            @click="loadExample(example)">
                            <div class="example-info">
                                <h4 v-text="example.name"></h4>
                                <p v-text="example.description"></p>
                                <el-tag :type="example.type === 'crewai' ? 'success' : 'warning'"
                                        v-text="example.type">
                                </el-tag>
                            </div>
                        </el-card>
                    </div>
                </el-aside>

                <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
                <el-main class="main-content">
                    <!-- Á≥ªÁªüÊâ´Êèè -->
                    <div v-show="activeTab === 'scanner'" class="tab-content">
                        <el-card class="content-card">
                            <template #header>
                                <h2>üîç Á≥ªÁªüÊâ´Êèè</h2>
                            </template>
                            
                            <el-form :model="scanForm" label-width="120px">
                                <el-form-item label="Êâ´ÊèèË∑ØÂæÑ">
                                    <el-input 
                                        v-model="scanForm.path" 
                                        placeholder="ËØ∑ËæìÂÖ•Ë¶ÅÊâ´ÊèèÁöÑÁõÆÂΩïÊàñÊñá‰ª∂Ë∑ØÂæÑ"
                                        class="path-input">
                                        <template #append>
                                            <el-button @click="selectPath">ÊµèËßà</el-button>
                                        </template>
                                    </el-input>
                                </el-form-item>
                                
                                <el-form-item label="Êâ´ÊèèÁ±ªÂûã">
                                    <el-radio-group v-model="scanForm.type">
                                        <el-radio label="directory">ÁõÆÂΩï</el-radio>
                                        <el-radio label="file">Âçï‰∏™Êñá‰ª∂</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                
                                <el-form-item>
                                    <el-button 
                                        type="primary" 
                                        @click="executeScan"
                                        :loading="scanLoading">
                                        ÂºÄÂßãÊâ´Êèè
                                    </el-button>
                                    <el-button @click="clearScanResult">Ê∏ÖÁ©∫ÁªìÊûú</el-button>
                                    <el-button type="info" @click="loadDemoData">Âä†ËΩΩÊºîÁ§∫Êï∞ÊçÆ</el-button>
                                </el-form-item>
                            </el-form>

                            <!-- Êâ´ÊèèÁªìÊûú -->
                            <div v-if="scanResult" class="result-section">
                                <h3>Êâ´ÊèèÁªìÊûú</h3>
                                <el-row :gutter="20">
                                    <el-col :span="8">
                                        <el-statistic title="Agents" :value="scanResult.scan_summary?.total_agents || 0" />
                                    </el-col>
                                    <el-col :span="8">
                                        <el-statistic title="Tools" :value="scanResult.scan_summary?.total_tools || 0" />
                                    </el-col>
                                    <el-col :span="8">
                                        <el-statistic title="Files" :value="scanResult.scan_summary?.total_files || 0" />
                                    </el-col>
                                </el-row>

                                <el-divider />

                                <!-- AgentsÂàóË°® -->
                                <div v-if="scanResult.agents && scanResult.agents.length > 0">
                                    <h4>ÂèëÁé∞ÁöÑAgents</h4>
                                    <el-table :data="scanResult.agents" style="width: 100%">
                                        <el-table-column prop="name" label="ÂêçÁß∞" width="150" />
                                        <el-table-column prop="arguments.role" label="ËßíËâ≤" width="200" />
                                        <el-table-column prop="file" label="Êñá‰ª∂" show-overflow-tooltip />
                                        <el-table-column prop="line" label="Ë°åÂè∑" width="80" />
                                    </el-table>
                                </div>
                            </div>
                        </el-card>
                    </div>

                    <!-- ÂÖ≥Á≥ªÂõæÊûÑÂª∫ -->
                    <div v-show="activeTab === 'graph'" class="tab-content">
                        <el-card class="content-card">
                            <template #header>
                                <h2>üîó ÂÖ≥Á≥ªÂõæÊûÑÂª∫</h2>
                            </template>
                            
                            <el-form :model="graphForm" label-width="120px">
                                <el-form-item label="Êï∞ÊçÆÊ∫ê">
                                    <el-radio-group v-model="graphForm.dataSource">
                                        <el-radio label="scan">‰ΩøÁî®Êâ´ÊèèÁªìÊûú</el-radio>
                                        <el-radio label="path">Áõ¥Êé•Êâ´ÊèèË∑ØÂæÑ</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                
                                <el-form-item v-if="graphForm.dataSource === 'path'" label="Êâ´ÊèèË∑ØÂæÑ">
                                    <el-input v-model="graphForm.path" placeholder="ËØ∑ËæìÂÖ•Ë∑ØÂæÑ" />
                                </el-form-item>
                                
                                <el-form-item>
                                    <el-button 
                                        type="primary" 
                                        @click="buildGraph"
                                        :loading="graphLoading"
                                        :disabled="graphForm.dataSource === 'scan' && !scanResult">
                                        ÊûÑÂª∫ÂÖ≥Á≥ªÂõæ
                                    </el-button>
                                    <el-button type="info" @click="loadDemoGraph">Âä†ËΩΩÊºîÁ§∫Âõæ</el-button>
                                </el-form-item>
                            </el-form>

                            <!-- ÂõæÂèØËßÜÂåñ -->
                            <div v-if="graphResult" class="graph-visualization">
                                <h3>ÂÖ≥Á≥ªÂõæ</h3>
                                <div id="graph-container" class="graph-container"></div>
                                
                                <!-- ÂõæÁªüËÆ°‰ø°ÊÅØ -->
                                <el-row :gutter="20" class="graph-stats">
                                    <el-col :span="6">
                                        <el-statistic title="ËäÇÁÇπÊï∞" :value="graphResult.metadata?.total_nodes || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic title="ËæπÊï∞" :value="graphResult.metadata?.total_edges || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic title="ÁªÑ‰ª∂Êï∞" :value="graphResult.metadata?.components || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic title="ÂØÜÂ∫¶" :value="graphResult.metadata?.density || 0" :precision="3" />
                                    </el-col>
                                </el-row>
                            </div>
                        </el-card>
                    </div>

                    <!-- Ë∑ØÂæÑÂàÜÊûê -->
                    <div v-show="activeTab === 'paths'" class="tab-content">
                        <el-card class="content-card">
                            <template #header>
                                <h2>üõ£Ô∏è Ë∑ØÂæÑÂàÜÊûê</h2>
                            </template>
                            
                            <el-form :model="pathsForm" label-width="120px">
                                <el-form-item label="Êï∞ÊçÆÊ∫ê">
                                    <el-radio-group v-model="pathsForm.dataSource">
                                        <el-radio label="graph">‰ΩøÁî®ÂõæÊï∞ÊçÆ</el-radio>
                                        <el-radio label="file">ÂõæÊñá‰ª∂</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                
                                <el-form-item v-if="pathsForm.dataSource === 'file'" label="ÂõæÊñá‰ª∂">
                                    <el-input v-model="pathsForm.graphFile" placeholder="ËØ∑ËæìÂÖ•ÂõæÊñá‰ª∂Ë∑ØÂæÑ" />
                                </el-form-item>
                                
                                <el-form-item>
                                    <el-button 
                                        type="primary" 
                                        @click="analyzePaths"
                                        :loading="pathsLoading"
                                        :disabled="pathsForm.dataSource === 'graph' && !graphResult">
                                        ÂàÜÊûêË∑ØÂæÑ
                                    </el-button>
                                </el-form-item>
                            </el-form>

                            <!-- Ë∑ØÂæÑÂàÜÊûêÁªìÊûú -->
                            <div v-if="pathsResult" class="paths-result">
                                <h3>Ë∑ØÂæÑÂàÜÊûêÁªìÊûú</h3>
                                
                                <!-- Ë∑ØÂæÑÁªüËÆ° -->
                                <el-row :gutter="20">
                                    <el-col :span="8">
                                        <el-statistic 
                                            title="ÊÄªË∑ØÂæÑÊï∞" 
                                            :value="pathsResult.analysis_summary?.total_paths || 0" />
                                    </el-col>
                                    <el-col :span="8">
                                        <el-statistic 
                                            title="ÂÖ≥ÈîÆË∑ØÂæÑ" 
                                            :value="pathsResult.analysis_summary?.critical_paths || 0" />
                                    </el-col>
                                    <el-col :span="8">
                                        <el-statistic 
                                            title="Âπ≥ÂùáÈïøÂ∫¶" 
                                            :value="pathsResult.analysis_summary?.average_length || 0" 
                                            :precision="2" />
                                    </el-col>
                                </el-row>

                                <!-- ÂÖ≥ÈîÆË∑ØÂæÑÂàóË°® -->
                                <div v-if="pathsResult.critical_paths">
                                    <h4>ÂÖ≥ÈîÆË∑ØÂæÑ</h4>
                                    <el-collapse>
                                        <el-collapse-item 
                                            v-for="(path, index) in pathsResult.critical_paths.slice(0, 10)" 
                                            :key="index"
                                            :title="`Ë∑ØÂæÑ ${index + 1} - ÈïøÂ∫¶: ${path.length}`">
                                            <el-tag 
                                                v-for="(node, nodeIndex) in path.path" 
                                                :key="nodeIndex"
                                                class="path-node"
                                                v-text="node">
                                            </el-tag>
                                        </el-collapse-item>
                                    </el-collapse>
                                </div>
                            </div>
                        </el-card>
                    </div>

                    <!-- Êó•ÂøóÂàÜÊûê -->
                    <div v-show="activeTab === 'logs'" class="tab-content">
                        <el-card class="content-card">
                            <template #header>
                                <h2>üìä Êó•ÂøóÂàÜÊûê</h2>
                            </template>
                            
                            <el-form :model="logsForm" label-width="120px">
                                <el-form-item label="Êó•ÂøóÊñá‰ª∂">
                                    <el-input v-model="logsForm.logFile" placeholder="ËØ∑ËæìÂÖ•Êó•ÂøóÊñá‰ª∂Ë∑ØÂæÑ" />
                                </el-form-item>
                                
                                <el-form-item label="Êó•ÂøóÊ†ºÂºè">
                                    <el-select v-model="logsForm.format">
                                        <el-option label="Ëá™Âä®Ê£ÄÊµã" value="auto" />
                                        <el-option label="CSVÊ†ºÂºè" value="csv" />
                                        <el-option label="ÊñáÊú¨Ê†ºÂºè" value="txt" />
                                    </el-select>
                                </el-form-item>
                                
                                <el-form-item label="ÂõæÊñá‰ª∂">
                                    <el-input v-model="logsForm.graphFile" placeholder="ÂèØÈÄâÔºöÁî®‰∫éË∑ØÂæÑÈ™åËØÅÁöÑÂõæÊñá‰ª∂" />
                                </el-form-item>
                                
                                <el-form-item>
                                    <el-button 
                                        type="primary" 
                                        @click="analyzeLogs"
                                        :loading="logsLoading">
                                        ÂàÜÊûêÊó•Âøó
                                    </el-button>
                                </el-form-item>
                            </el-form>

                            <!-- Êó•ÂøóÂàÜÊûêÁªìÊûú -->
                            <div v-if="logsResult" class="logs-result">
                                <h3>Êó•ÂøóÂàÜÊûêÁªìÊûú</h3>
                                
                                <!-- ÊâßË°åÁªüËÆ° -->
                                <el-row :gutter="20">
                                    <el-col :span="6">
                                        <el-statistic 
                                            title="ÊÄªÊù°ÁõÆÊï∞" 
                                            :value="logsResult.log_summary?.total_entries || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic 
                                            title="ÊâßË°åË∑ØÂæÑ" 
                                            :value="logsResult.execution_paths?.length || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic 
                                            title="ÂºÇÂ∏∏Êï∞Èáè" 
                                            :value="logsResult.anomalies?.length || 0" />
                                    </el-col>
                                    <el-col :span="6">
                                        <el-statistic 
                                            title="ÊàêÂäüÁéá" 
                                            :value="calculateSuccessRate(logsResult)" 
                                            suffix="%" />
                                    </el-col>
                                </el-row>

                                <!-- ÂºÇÂ∏∏ÂàóË°® -->
                                <div v-if="logsResult.anomalies && logsResult.anomalies.length > 0">
                                    <h4>Ê£ÄÊµãÂà∞ÁöÑÂºÇÂ∏∏</h4>
                                    <el-alert 
                                        v-for="(anomaly, index) in logsResult.anomalies" 
                                        :key="index"
                                        :title="anomaly.type"
                                        :description="anomaly.description"
                                        type="warning"
                                        class="anomaly-alert" />
                                </div>

                                <!-- Âª∫ËÆÆ -->
                                <div v-if="logsResult.recommendations && logsResult.recommendations.length > 0">
                                    <h4>‰ºòÂåñÂª∫ËÆÆ</h4>
                                    <ul class="recommendations-list">
                                        <li v-for="(rec, index) in logsResult.recommendations" :key="index"
                                            v-text="rec">
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </el-card>
                    </div>

                    <!-- ÂàÜÊûêÁªìÊûú -->
                    <div v-show="activeTab === 'results'" class="tab-content">
                        <el-card class="content-card">
                            <template #header>
                                <h2>üìÅ ÂàÜÊûêÁªìÊûú</h2>
                            </template>
                            
                            <el-button @click="loadResults" type="primary" class="refresh-btn">
                                Âà∑Êñ∞ÂàóË°®
                            </el-button>

                            <el-table :data="resultFiles" style="width: 100%">
                                <el-table-column prop="filename" label="Êñá‰ª∂Âêç" show-overflow-tooltip />
                                <el-table-column prop="type" label="Á±ªÂûã" width="100">
                                    <template #default="scope">
                                        <el-tag :type="getResultTypeColor(scope.row.type)"
                                                v-text="scope.row.type">
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="size" label="Â§ßÂ∞è" width="100">
                                    <template #default="scope">
                                        <span v-text="formatFileSize(scope.row.size)"></span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="modified" label="‰øÆÊîπÊó∂Èó¥" width="200">
                                    <template #default="scope">
                                        <span v-text="formatDate(scope.row.modified)"></span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Êìç‰Ωú" width="150">
                                    <template #default="scope">
                                        <el-button 
                                            size="small" 
                                            @click="viewResult(scope.row)">
                                            Êü•Áúã
                                        </el-button>
                                        <el-button 
                                            size="small" 
                                            type="danger" 
                                            @click="deleteResult(scope.row)">
                                            Âà†Èô§
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-card>
                    </div>
                </el-main>
            </el-container>
        </el-container>

        <!-- ÂÖ≥‰∫éÂØπËØùÊ°Ü -->
        <el-dialog v-model="showAbout" title="ÂÖ≥‰∫é Watchdog" width="50%">
            <div class="about-content">
                <h3>üîç Watchdog - AgentÁ≥ªÁªüÊ£ÄÊµã‰∏éÂàÜÊûêÂ∑•ÂÖ∑</h3>
                <p>WatchdogÊòØ‰∏Ä‰∏™‰∏ìÈó®Áî®‰∫éÂàÜÊûêÂíåÊ£ÄÊµãAgentÁ≥ªÁªüÁöÑÁªºÂêàÂ∑•ÂÖ∑ÔºåÊèê‰æõ‰ª•‰∏ãÂäüËÉΩÔºö</p>
                <ul>
                    <li>üîç <strong>Á≥ªÁªüÊâ´Êèè</strong>ÔºöËá™Âä®ËØÜÂà´Agent„ÄÅTools„ÄÅCrewsÁ≠âÁªÑ‰ª∂</li>
                    <li>üîó <strong>ÂÖ≥Á≥ªÂõæÊûÑÂª∫</strong>ÔºöÊûÑÂª∫Á≥ªÁªüÁªÑ‰ª∂Èó¥ÁöÑÂÖ≥Á≥ªÂõæ</li>
                    <li>üõ£Ô∏è <strong>Ë∑ØÂæÑÂàÜÊûê</strong>ÔºöÂàÜÊûêÊâßË°åË∑ØÂæÑÂíåÂÖ≥ÈîÆË∑ØÂæÑ</li>
                    <li>üìä <strong>Êó•ÂøóÂàÜÊûê</strong>ÔºöÊ∑±Â∫¶ÂàÜÊûêÊâßË°åÊó•ÂøóÔºåÊ£ÄÊµãÂºÇÂ∏∏</li>
                </ul>
                <p>ÊîØÊåÅÁöÑÊ°ÜÊû∂ÔºöCrewAI„ÄÅAutoGen„ÄÅLangChainÁ≠â‰∏ªÊµÅAgentÊ°ÜÊû∂</p>
            </div>
        </el-dialog>

        <!-- ÁªìÊûúÊü•ÁúãÂØπËØùÊ°Ü -->
        <el-dialog v-model="showResultDialog" :title="currentResult?.filename" width="80%">
            <pre class="result-content" v-text="JSON.stringify(currentResultData, null, 2)"></pre>
        </el-dialog>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
